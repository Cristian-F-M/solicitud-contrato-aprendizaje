const containerFilterDepartments=document.querySelector(".container-filter-departments"),containerFilterCities=document.querySelector(".container-filter-cities"),filterByDepartment=document.querySelector("#send-departments"),filterByCity=document.querySelector("#send-cities"),closeFilterDepartments=document.querySelector("#close-filter-department"),closeFilterCities=document.querySelector("#close-filter-city"),sendAll=document.querySelector("#send-all"),containerLocationsDepartments=containerFilterDepartments.querySelector(".container-locations"),containerLocationsCities=containerFilterCities.querySelector(".container-locations"),containerUpDown=document.querySelectorAll(".container-up-down"),mainsFilter=document.querySelectorAll(".main-filter"),buttonsApply=[...document.querySelectorAll(".button-apply")],containerFilters=document.querySelector(".container-filters"),containersInput=containerFilters.querySelectorAll(".container-input"),containerInformation=document.querySelector(".container-information"),informationLocations=containerInformation.querySelector(".information_container-locations .locations"),sendEmails=document.querySelector("#send-emails"),filterSelected={inputChecked:checkFilterSelected()};function showFilterDepartments(){showFilter(containerFilterDepartments)}function showFilterCities(){showFilter(containerFilterCities)}function showFilter(e){e?.classList.add("show")}function hideFilter(e){e.classList.remove("show"),!checkInputsChecked(e)&&resetAll(e)}function checkInputsChecked(e){let t=e.querySelectorAll('input[type="checkbox"]'),n=!1;return t.forEach((e=>{e.checked&&(n=!0)})),n}function resetAll(e,t=!1){let n=e.querySelectorAll('input[type="checkbox"]'),i=e.querySelector("header"),r=e.querySelector(".main-filter"),l=filterSelected.inputChecked.id,o=document.querySelector(`input#${l}`);n.forEach((e=>{e.checked=!1})),o.checked=!0,t&&(sendAll.checked=!0),i.classList.remove("scroll-blur"),r.scrollTop=0}sendAll.addEventListener("change",(()=>{resetAll(containerFilterDepartments,!0),resetAll(containerFilterCities,!0),addSendTo({dataName:"all"}),containerInformation.setAttribute("show","all")})),filterByDepartment.addEventListener("change",(()=>{setTimeout((()=>{filterByDepartment.checked&&showFilterDepartments()}),200)})),filterByCity.addEventListener("change",(()=>{setTimeout((()=>{filterByCity.checked&&showFilterCities()}),200)})),closeFilterCities.addEventListener("click",(()=>{hideFilter(containerFilterCities)})),closeFilterDepartments.addEventListener("click",(()=>{hideFilter(containerFilterDepartments)})),containerUpDown.forEach((e=>{e.addEventListener("click",(()=>{e.closest(".main-filter").querySelector(".button-apply").scrollIntoView({behavior:"smooth"})}))})),mainsFilter.forEach((e=>{let t=e.querySelector(".container-up-down"),n=e.querySelector("header");e.addEventListener("scroll",(()=>{let i=e.scrollHeight-e.scrollTop;e.scrollTop>0?n.classList.add("scroll-blur"):n.classList.remove("scroll-blur"),i===e.clientHeight?t.classList.add("hidden"):i>e.clientHeight+80&&t.classList.remove("hidden")}))}));for(let e in buttonsApply){let t=buttonsApply[e];t.addEventListener("click",(e=>{let n=t.closest(".overlay-filter"),i="location";0===n.querySelectorAll('input[type="checkbox"]:checked').length&&(sendAll.checked=!0,i="all"),getLocationsFilter(e),updateContainerLocations(n),containerInformation.setAttribute("show",i)}))}async function addSendTo(e,t=void 0){let n=t?.closest(".overlay-filter"),i=await fetch("/Location/Send-to/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i=await i.json(),!i.ok)return createMessage("An error occurred while processing the request",!0),void resetAll(t);createMessage("filters have been applied correctly",!1),t&&hideFilter(n)}function getLocationsFilter({target:e}){let t=e.closest(".main-filter"),n=e.dataset.name,i=t.querySelectorAll('input[type="checkbox"]'),r=[];i.forEach((e=>{if(e.checked){let t=parseInt(e.value);r.push(t)}})),addSendTo({dataName:n,locations:r},t)}function checkFilterSelected(){let e=[...containersInput];for(let t in e){let n=e[t].querySelector("input");if(n.checked)return n}return sendAll}function updateContainerLocations(e){informationLocations.innerHTML="",e.querySelectorAll('input[type="checkbox"]:checked').forEach((e=>{let t=e.closest(".container-input").querySelector("label"),n=document.createElement("span");n.innerText=t.innerText,n.setAttribute("value",e.id),n.classList.add("tag"),informationLocations.appendChild(n)}))}async function send_emails(){let e=await sendApi({send_to:"user"}),t=confirm("We have sent you an example email so you can review the final result. Upon confirmation, the emails will be sent to all companies. ");if(t)return e=await sendApi({send_to:"all"}),t=await e.json(),await new Promise((e=>setTimeout(e,2e3))),t}async function sendApi(e){sendEmails.disabled=!0,showFullLoading("Sending emails");let t=await fetch("/User/Send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return sendEmails.disabled=!1,hideFullLoading(),t}containersInput.forEach((e=>{let t=e.querySelector("label");t.addEventListener("click",(()=>{let n=e.querySelector("input"),i=t.getAttribute("for").split("-")[1],r=document.querySelector(`.container-filter-${i}`);n.checked&&showFilter(r)}))})),sendEmails.addEventListener("click",(async()=>{let e=await send_emails();if(e.status)createMessage("The email has been sent correctly to all companies");else{let t=e.message?e.message:"An error occurred while processing the request";createMessage(t,!0)}}));